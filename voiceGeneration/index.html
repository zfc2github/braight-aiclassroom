<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè¯­éŸ³åˆæˆå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e2e8f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(94, 234, 212, 0.2);
        }

        .header {
            background: linear-gradient(45deg, #0ea5e9, #0d9488);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(94, 234, 212, 0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        .input-section {
            padding: 40px;
            background: rgba(15, 23, 42, 0.5);
            border-bottom: 1px solid rgba(94, 234, 212, 0.1);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #94a3b8;
            font-size: 1.1em;
        }

        .voice-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #334155;
            border-radius: 8px;
            font-size: 16px;
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .voice-select:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .voice-select option {
            padding: 10px;
            background: #1e293b;
        }

        .text-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #334155;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
        }

        .text-input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .char-counter {
            text-align: right;
            margin-top: 5px;
            font-size: 14px;
            color: #94a3b8;
        }

        .char-counter.warning {
            color: #f59e0b;
            font-weight: 600;
        }

        .char-counter.error {
            color: #ef4444;
            font-weight: 600;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(45deg, #0ea5e9, #0d9488);
            color: white;
            position: relative;
            z-index: 1;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #0d9488, #0ea5e9);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .btn-primary:hover::before {
            opacity: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(14, 165, 233, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #8b5cf6, #7c3aed);
            color: white;
            position: relative;
            z-index: 1;
        }

        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #7c3aed, #8b5cf6);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .btn-secondary:hover::before {
            opacity: 1;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn:disabled::before {
            display: none;
        }

        .btn .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .output-section {
            flex: 1;
            padding: 40px;
            background: rgba(15, 23, 42, 0.5);
            display: flex;
            flex-direction: column;
        }

        .status-area {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            border-left: 4px solid #0ea5e9;
        }

        .status-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 10px;
        }

        .status-message {
            color: #cbd5e1;
            font-size: 14px;
            line-height: 1.6;
        }

        .status-message.success {
            color: #10b981;
        }

        .status-message.error {
            color: #ef4444;
        }

        .status-message.warning {
            color: #f59e0b;
        }

        .audio-player-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            border: 2px dashed #334155;
            transition: all 0.3s ease;
        }

        .audio-player-area.has-audio {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.05);
        }

        .audio-placeholder {
            text-align: center;
            color: #64748b;
        }

        .audio-placeholder .icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .audio-player {
            width: 100%;
            max-width: 500px;
        }

        .audio-player audio {
            width: 100%;
            border-radius: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .audio-info {
            margin-top: 15px;
            text-align: center;
            color: #94a3b8;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #334155;
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #0ea5e9, #0d9488);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .api-key-section {
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            border: 1px solid #334155;
        }

        .api-key-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #334155;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .voice-filter {
            margin-bottom: 15px;
            display: flex;
            justify-content: flex-start;
        }

        .voice-filter div {
            width: 30%;
            margin-right: 30px;
        }
        
        .voice-filter input {
            width: 30%;
            padding: 8px 15px;
            border: 2px solid #334155;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
        }

        .voice-filter input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .voice-category {
            margin-bottom: 10px;
        }

        .voice-category select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #334155;
            border-radius: 6px;
            font-size: 14px;
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
        }

        .voice-category select:focus {
            outline: none;
            border-color: #0ea5e9;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(94, 234, 212, 0.2);
            box-shadow: 0 8px 32px rgba(2, 8, 20, 0.4);
        }

        .glass-title {
            background: linear-gradient(45deg, #0ea5e9, #0d9488);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .input-section, .output-section {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .button-group {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ™ï¸ AIè¯­éŸ³åˆæˆå·¥å…·</h1>
        <p>åŸºäºé˜¿é‡Œäº‘è¯­éŸ³åˆæˆæ¥å£</p>
    </div>

    <div class="main-content">
        <div class="input-section">

            <div class="form-group">
                <label for="voice">ğŸ­ é€‰æ‹©éŸ³è‰²</label>
                <div class="voice-filter">
                    <div class="voice-category">
                        <select id="voiceCategory">
                            <option value="all">ğŸ“‹ æ‰€æœ‰éŸ³è‰²</option>
                            <option value="chinese">ğŸ‡¨ğŸ‡³ ä¸­æ–‡éŸ³è‰²</option>
                            <option value="english">ğŸ‡¬ğŸ‡§ è‹±æ–‡éŸ³è‰²</option>
                            <option value="custom">â­ è‡ªå®šä¹‰éŸ³è‰²</option>
                        </select>
                    </div>
                    <div class="voice-category">
                        <select id="voice" class="voice-select" required>
                            <option value="">è¯·é€‰æ‹©éŸ³è‰²...</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="text">ğŸ“ è¯­éŸ³æ–‡æœ¬</label>
                <textarea id="text" class="text-input" placeholder="è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬å†…å®¹ï¼ˆä¸è¶…è¿‡500å­—ç¬¦ï¼‰" maxlength="500" required></textarea>
                <div class="char-counter" id="charCounter">0 / 500</div>
            </div>

            <div class="button-group">
                <button id="synthesizeBtn" class="btn btn-primary">
                    <span id="btnText">ğŸµ å¼€å§‹åˆæˆ</span>
                </button>
            </div>
        </div>

        <div class="output-section">
            <div class="status-area">
                <div class="status-title">ğŸ“Š çŠ¶æ€ä¿¡æ¯</div>
                <div class="status-message" id="statusMessage">è¯·è¾“å…¥æ–‡æœ¬å¹¶é€‰æ‹©éŸ³è‰²ï¼Œç„¶åç‚¹å‡»"å¼€å§‹åˆæˆ"æŒ‰é’®</div>
            </div>

            <div class="audio-player-area" id="audioPlayerArea">
                <div class="audio-player hidden" id="audioPlayer">
                    <audio id="audioElement" controls></audio>
                    <div class="audio-info" id="audioInfo"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    class VoiceSynthesisApp {
        constructor() {
            this.voices = [];
            this.customVoices = [];
            this.listVoiceUrl = 'https://aiclassroom.braightidea.com/nodejsProxy/listVoice';
            this.speechGenerationUrl = 'https://aiclassroom.braightidea.com/nodejsProxy/speech_generation';

            this.init();
        }

        init() {
            this.setupEventListeners();
            this.loadVoices();
            this.setupTextCounter();
        }

        setupEventListeners() {
            // åˆæˆæŒ‰é’®
            document.getElementById('synthesizeBtn').addEventListener('click', () => this.handleSynthesize());

            // éŸ³è‰²åˆ†ç±»
            document.getElementById('voiceCategory').addEventListener('change', (e) => this.filterVoicesByCategory(e.target.value));

            // æ–‡æœ¬è¾“å…¥é™åˆ¶
            document.getElementById('text').addEventListener('input', () => this.updateTextCounter());
            
        }

        async loadVoices() {
            const defaultVoices = [
                { name: 'é¾™åº”ç¬‘', id: 'longyingxiao', category: 'chinese' },
                { name: 'é¾™æœºå™¨', id: 'longjiqi', category: 'chinese' },
                { name: 'é¾™çŒ´å“¥', id: 'longhouge', category: 'chinese' },
                { name: 'é¾™æœºå¿ƒ', id: 'longjixin', category: 'chinese' },
                { name: 'é¾™å®‰ç²¤', id: 'longanyue', category: 'chinese' },
                { name: 'é¾™é™•å“¥', id: 'longshange', category: 'chinese' },
                { name: 'é¾™å®‰æ•', id: 'longanmin', category: 'chinese' },
                { name: 'é¾™é»›ç‰', id: 'longdaiyu', category: 'chinese' },
                { name: 'é¾™é«˜åƒ§', id: 'longgaoseng', category: 'chinese' },
                { name: 'é¾™å®‰è‰', id: 'longanli', category: 'chinese' },
                { name: 'é¾™å®‰æœ—', id: 'longanlang', category: 'chinese' },
                { name: 'é¾™å®‰æ¸©', id: 'longanwen', category: 'chinese' },
                { name: 'é¾™å®‰æ˜€', id: 'longanyun', category: 'chinese' },
                { name: 'YUMI', id: 'longyumi_v2', category: 'chinese' },
                { name: 'é¾™å°æ·³', id: 'longxiaochun_v2', category: 'chinese' },
                { name: 'é¾™å°å¤', id: 'longxiaoxia_v2', category: 'chinese' },
                { name: 'é¾™é€¸å°˜', id: 'longyichen', category: 'chinese' },
                { name: 'é¾™å©‰å›', id: 'longwanjun', category: 'chinese' },
                { name: 'é¾™è€ä¼¯', id: 'longlaobo', category: 'chinese' },
                { name: 'é¾™è€å§¨', id: 'longlaoyi', category: 'chinese' },
                { name: 'é¾™ç™½èŠ·', id: 'longbaizhi', category: 'chinese' },
                { name: 'é¾™ä¸‰å”', id: 'longsanshu', category: 'chinese' },
                { name: 'é¾™ä¿®', id: 'longxiu_v2', category: 'chinese' },
                { name: 'é¾™å¦™', id: 'longmiao_v2', category: 'chinese' },
                { name: 'é¾™æ‚¦', id: 'longyue_v2', category: 'chinese' },
                { name: 'é¾™æ¥ ', id: 'longnan_v2', category: 'chinese' },
                { name: 'é¾™åª›', id: 'longyuan_v2', category: 'chinese' },
                { name: 'é¾™å®‰äº²', id: 'longanqin', category: 'chinese' },
                { name: 'é¾™å®‰é›…', id: 'longanya', category: 'chinese' },
                { name: 'é¾™å®‰æœ”', id: 'longanshuo', category: 'chinese' },
                { name: 'é¾™å®‰çµ', id: 'longanling', category: 'chinese' },
                { name: 'é¾™å®‰æ™º', id: 'longanzhi', category: 'chinese' },
                { name: 'é¾™å®‰æŸ”', id: 'longanrou', category: 'chinese' },
                { name: 'é¾™å«±', id: 'longqiang_v2', category: 'chinese' },
                { name: 'é¾™å¯’', id: 'longhan_v2', category: 'chinese' },
                { name: 'é¾™æ˜Ÿ', id: 'longxing_v2', category: 'chinese' },
                { name: 'é¾™å', id: 'longhua_v2', category: 'chinese' },
                { name: 'é¾™å©‰', id: 'longwan_v2', category: 'chinese' },
                { name: 'é¾™æ©™', id: 'longcheng_v2', category: 'chinese' },
                { name: 'é¾™è²è²', id: 'longfeifei_v2', category: 'chinese' },
                { name: 'é¾™å°è¯š', id: 'longxiaocheng_v2', category: 'chinese' },
                { name: 'é¾™å“²', id: 'longzhe_v2', category: 'chinese' },
                { name: 'é¾™é¢œ', id: 'longyan_v2', category: 'chinese' },
                { name: 'é¾™å¤©', id: 'longtian_v2', category: 'chinese' },
                { name: 'é¾™æ³½', id: 'longze_v2', category: 'chinese' },
                { name: 'é¾™é‚µ', id: 'longshao_v2', category: 'chinese' },
                { name: 'é¾™æµ©', id: 'longhao_v2', category: 'chinese' },
                { name: 'é¾™æ·±', id: 'kabuleshen_v2', category: 'chinese' },
                { name: 'é¾™å‘¼å‘¼', id: 'longhuhu', category: 'chinese' },
                { name: 'é¾™å®‰åŸ¹', id: 'longanpei', category: 'chinese' },
                { name: 'é¾™æ±ªæ±ª', id: 'longwangwang', category: 'chinese' },
                { name: 'é¾™æ³¡æ³¡', id: 'longpaopao', category: 'chinese' },
                { name: 'é¾™é—ªé—ª', id: 'longshanshan', category: 'chinese' },
                { name: 'é¾™ç‰›ç‰›', id: 'longniuniu', category: 'chinese' },
                { name: 'é¾™åº”æ²', id: 'longyingmu', category: 'chinese' },
                { name: 'é¾™åº”è¯¢', id: 'longyingxun', category: 'chinese' },
                { name: 'é¾™åº”å‚¬', id: 'longyingcui', category: 'chinese' },
                { name: 'é¾™åº”ç­”', id: 'longyingda', category: 'chinese' },
                { name: 'é¾™åº”é™', id: 'longyingjing', category: 'chinese' },
                { name: 'é¾™åº”ä¸¥', id: 'longyingyan', category: 'chinese' },
                { name: 'é¾™åº”ç”œ', id: 'longyingtian', category: 'chinese' },
                { name: 'é¾™åº”å†°', id: 'longyingbing', category: 'chinese' },
                { name: 'é¾™åº”æ¡ƒ', id: 'longyingtao', category: 'chinese' },
                { name: 'é¾™åº”è†', id: 'longyingling', category: 'chinese' },
                { name: 'é¾™å®‰ç‡ƒ', id: 'longanran', category: 'chinese' },
                { name: 'é¾™å®‰å®£', id: 'longanxuan', category: 'chinese' },
                { name: 'é¾™å®‰å†²', id: 'longanchong', category: 'chinese' },
                { name: 'é¾™å®‰è', id: 'longanping', category: 'chinese' },
                { name: 'é¾™æ°åŠ›è±†', id: 'longjielidou_v2', category: 'chinese' },
                { name: 'é¾™é“ƒ', id: 'longling_v2', category: 'chinese' },
                { name: 'é¾™å¯', id: 'longke_v2', category: 'chinese' },
                { name: 'é¾™ä»™', id: 'longxian_v2', category: 'chinese' },
                { name: 'é¾™è€é“', id: 'longlaotie_v2', category: 'chinese' },
                { name: 'é¾™å˜‰æ€¡', id: 'longjiayi_v2', category: 'chinese' },
                { name: 'é¾™æ¡ƒ', id: 'longtao_v2', category: 'chinese' },
                { name: 'é¾™é£', id: 'longfei_v2', category: 'chinese' },
                { name: 'æç™½', id: 'libai_v2', category: 'chinese' },
                { name: 'é¾™æ´¥', id: 'longjin_v2', category: 'chinese' },
                { name: 'é¾™ä¹¦', id: 'longshu_v2', category: 'chinese' },
                { name: 'Bella2.0', id: 'loongbella_v2', category: 'english' },
                { name: 'é¾™ç¡•', id: 'longshuo_v2', category: 'chinese' },
                { name: 'é¾™å°ç™½', id: 'longxiaobai_v2', category: 'chinese' },
                { name: 'é¾™å©§', id: 'longjing_v2', category: 'chinese' },
                { name: 'loongstella', id: 'loongstella_v2', category: 'english' },
                { name: 'loongyuuna', id: 'loongyuuna_v2', category: 'english' },
                { name: 'loongyuuma', id: 'loongyuuma_v2', category: 'english' },
                { name: 'loongjihun', id: 'loongjihun_v2', category: 'english' },
                { name: 'loongeva', id: 'loongeva_v2', category: 'english' },
                { name: 'loongbrian', id: 'loongbrian_v2', category: 'english' },
                { name: 'loongluna', id: 'loongluna_v2', category: 'english' },
                { name: 'loongluca', id: 'loongluca_v2', category: 'english' },
                { name: 'loongemily', id: 'loongemily_v2', category: 'english' },
                { name: 'loongeric', id: 'loongeric_v2', category: 'english' },
                { name: 'loongabby', id: 'loongabby_v2', category: 'english' },
                { name: 'loongannie', id: 'loongannie_v2', category: 'english' },
                { name: 'loongandy', id: 'loongandy_v2', category: 'english' },
                { name: 'loongava', id: 'loongava_v2', category: 'english' },
                { name: 'loongbeth', id: 'loongbeth_v2', category: 'english' },
                { name: 'loongbetty', id: 'loongbetty_v2', category: 'english' },
                { name: 'loongcindy', id: 'loongcindy_v2', category: 'english' },
                { name: 'loongcally', id: 'loongcally_v2', category: 'english' },
                { name: 'loongdavid', id: 'loongdavid_v2', category: 'english' },
                { name: 'loongdonna', id: 'loongdonna_v2', category: 'english' },
                { name: 'loongkyong', id: 'loongkyong_v2', category: 'english' },
                { name: 'loongtomoka', id: 'loongtomoka_v2', category: 'english' },
                { name: 'loongtomoya', id: 'loongtomoya_v2', category: 'english' }
            ];
            await this.loadCustomVoices();

            this.voices = [...defaultVoices, ...this.customVoices];
            this.populateVoiceSelect();
            this.updateStatus('âœ… éŸ³è‰²åŠ è½½å®Œæˆ', 'success');
        }

        populateVoiceSelect() {
            const voiceSelect = document.getElementById('voice');
            const currentValue = voiceSelect.value;

            voiceSelect.innerHTML = '<option value="">è¯·é€‰æ‹©éŸ³è‰²...</option>';

            this.voices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.id;
                option.textContent = `${voice.name} (${voice.id})`;
                option.dataset.category = voice.category;
                voiceSelect.appendChild(option);
            });

            // æ¢å¤ä¹‹å‰çš„é€‰æ‹©
            if (currentValue) {
                voiceSelect.value = currentValue;
            }
        }

        filterVoicesByCategory(category) {
            const voiceSelect = document.getElementById('voice');
            const options = voiceSelect.querySelectorAll('option:not([value=""])');

            options.forEach(option => {
                const optionCategory = option.dataset.category;
                const match = category === 'all' || optionCategory === category;
                option.style.display = match ? 'block' : 'none';
            });
        }

        async loadCustomVoices() {
            this.updateStatus('ğŸ”„ æ­£åœ¨åŠ è½½è‡ªå®šä¹‰éŸ³è‰²...', 'warning');

            try {
                const response = await fetch(this.listVoiceUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prefix: 'biVoice'
                    })
                });

                if (!response.ok) {
                    console.log(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                    this.updateStatus('ğŸ”„ åŠ è½½è‡ªå®šä¹‰éŸ³è‰²å¤±è´¥', 'danger');
                    this.customVoices = [];
                    return;
                }

                const data = await response.json();
                console.log('è‡ªå®šä¹‰éŸ³è‰²åˆ—è¡¨:', data);

                if (data?.data?.output?.voice_list) {
                    this.customVoices = data?.data?.output?.voice_list
                        .filter(voice => voice.status === 'OK')
                        .map(voice => ({
                            name: voice.voice_id,
                            id: voice.voice_id,
                            category: 'custom'
                        }));

                    this.updateStatus(`âœ… æˆåŠŸåŠ è½½ ${this.customVoices.length} ä¸ªè‡ªå®šä¹‰éŸ³è‰²`, 'success');
                } else {
                    this.updateStatus('â„¹ï¸ æ²¡æœ‰æ‰¾åˆ°è‡ªå®šä¹‰éŸ³è‰²', 'warning');
                }
            } catch (error) {
                console.error('åŠ è½½è‡ªå®šä¹‰éŸ³è‰²å¤±è´¥:', error);
                this.updateStatus(`âŒ åŠ è½½è‡ªå®šä¹‰éŸ³è‰²å¤±è´¥: ${error.message}`, 'error');
            } finally {
            }
        }

        setupTextCounter() {
            this.updateTextCounter();
        }

        updateTextCounter() {
            const textInput = document.getElementById('text');
            const counter = document.getElementById('charCounter');
            const length = textInput.value.length;

            counter.textContent = `${length} / 500`;

            // æ›´æ–°è®¡æ•°å™¨æ ·å¼
            counter.classList.remove('warning', 'error');
            if (length > 450) {
                counter.classList.add('error');
            } else if (length > 400) {
                counter.classList.add('warning');
            }
        }

        async handleSynthesize() {
            const voice = document.getElementById('voice').value;
            const text = document.getElementById('text').value.trim();
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.classList.add('hidden');

            // éªŒè¯è¾“å…¥
            if (!voice) {
                this.updateStatus('âŒ è¯·é€‰æ‹©éŸ³è‰²', 'error');
                document.getElementById('voice').focus();
                return;
            }

            if (!text) {
                this.updateStatus('âŒ è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬', 'error');
                document.getElementById('text').focus();
                return;
            }

            if (text.length > 500) {
                this.updateStatus('âŒ æ–‡æœ¬é•¿åº¦ä¸èƒ½è¶…è¿‡500å­—ç¬¦', 'error');
                return;
            }

            this.setLoading(true, 'synthesizeBtn');
            this.updateStatus('ğŸ”„ æ­£åœ¨è¿æ¥è¯­éŸ³åˆæˆæœåŠ¡...', 'warning');

            try {
                // ä½¿ç”¨WebSocketè¿æ¥è¿›è¡Œè¯­éŸ³åˆæˆ
                await this.synthesizeSpeech(voice, text);
            } catch (error) {
                console.error('è¯­éŸ³åˆæˆå¤±è´¥:', error);
                this.updateStatus(`âŒ è¯­éŸ³åˆæˆå¤±è´¥: ${error.message}`, 'error');
            } finally {
                this.setLoading(false, 'synthesizeBtn');
            }
        }

        async synthesizeSpeech(voice, text) {
            // ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼ŒWebSocketè¿æ¥éœ€è¦æœåŠ¡å™¨æ”¯æŒ
            // è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿçš„HTTPè¯·æ±‚æ¥æ¼”ç¤ºåŠŸèƒ½
            this.updateStatus('ğŸ”„ æ­£åœ¨åˆæˆè¯­éŸ³...', 'warning');

            try {
                // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥ä½¿ç”¨WebSocketè¿æ¥
                // ç”±äºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨HTTPè¯·æ±‚æ¥æ¨¡æ‹Ÿ
                const response = await fetch(this.speechGenerationUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        voice_id: voice,
                        text: text
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                }

                const data = await response.json();
                console.log('è¯­éŸ³åˆæˆç»“æœ:', data);

                if (data?.data) {
                    this.displayAudio(data.data, voice, text);
                    this.updateStatus('âœ… è¯­éŸ³åˆæˆå®Œæˆï¼', 'success');
                } else {
                    throw new Error('å“åº”æ ¼å¼é”™è¯¯ï¼šæœªæ‰¾åˆ°éŸ³é¢‘URL');
                }
            } catch (error) {
                throw error;
            }
        }

        displayAudio(audioUrl) {
            const audioElement = document.getElementById('audioElement');
            const audioPlayer = document.getElementById('audioPlayer');
            // è®¾ç½®éŸ³é¢‘æº
            audioElement.src = audioUrl;

            // æ˜¾ç¤ºéŸ³é¢‘æ’­æ”¾å™¨
            audioPlayer.classList.remove('hidden');
        }

        updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status-message ${type}`;
        }

        setLoading(loading, buttonId = 'synthesizeBtn') {
            const button = document.getElementById(buttonId);
            const btnText = button.querySelector('#btnText, span');

            if (loading) {
                button.disabled = true;
                const originalText = btnText.textContent;
                btnText.innerHTML = '<span class="loading"></span>å¤„ç†ä¸­...';
                button.dataset.originalText = originalText;
            } else {
                button.disabled = false;
                btnText.textContent = button.dataset.originalText || 'å¼€å§‹åˆæˆ';
            }
        }

        showConfetti() {
            // ç®€å•çš„åº†ç¥åŠ¨ç”»
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];

            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = '50%';
                    confetti.style.pointerEvents = 'none';
                    confetti.style.zIndex = '9999';
                    confetti.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;

                    document.body.appendChild(confetti);

                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }, i * 50);
            }

            // æ·»åŠ ä¸‹è½åŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                    @keyframes fall {
                        to {
                            transform: translateY(100vh) rotate(360deg);
                            opacity: 0;
                        }
                    }
                `;
            document.head.appendChild(style);
        }
    }

    // åˆå§‹åŒ–åº”ç”¨
    document.addEventListener('DOMContentLoaded', () => {
        new VoiceSynthesisApp();
    });

    // æ·»åŠ ä¸€äº›å…¨å±€æ ·å¼
    const globalStyle = document.createElement('style');
    globalStyle.textContent = `
            .hidden {
                display: none !important;
            }
            
            .fade-in {
                animation: fadeIn 0.5s ease-in;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .pulse {
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.02); }
                100% { transform: scale(1); }
            }
            
            .loading {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 3px solid rgba(255,255,255,0.3);
                border-radius: 50%;
                border-top-color: white;
                animation: spin 1s ease-in-out infinite;
                margin-right: 10px;
            }
            
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
    document.head.appendChild(globalStyle);
</script>
</body>
</html>